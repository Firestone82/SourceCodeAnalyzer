<div class="flex flex-col gap-4">
  <nz-card nzSize="small" class="ml-[5px] w-full max-w-none rounded-[10px]">
    <div class="flex items-center justify-between">
      <div>
        <div nz-typography nzType="secondary">Prompts</div>
        <div nz-typography>Browse available prompt templates.</div>
      </div>

      <button
        nz-button
        nzType="primary"
        (click)="openReviewModal()"
      >
        Start review
      </button>
    </div>

    @if (errorMessage) {
      <div nz-typography nzType="danger" class="mt-3">{{ errorMessage }}</div>
    }
  </nz-card>

  <nz-spin [nzSpinning]="isLoading" nzTip="Loading...">
    <div class="grid grid-cols-5 gap-4">
      <div class="col-span-1">
        <nz-sider>
          <ul nz-menu nzMode="inline" nzSelectable>
            @for (promptPath of pagedPromptPaths; track promptPath) {
              <li
                nz-menu-item
                [nzSelected]="promptPath === selectedPromptPath"
                (click)="selectPrompt(promptPath)"
              >
                <span>{{ promptPath }}</span>
              </li>
            }
          </ul>

          <div class="mt-3 flex justify-center">
            <nz-pagination
              [nzPageIndex]="pageIndex"
              [nzTotal]="promptPaths.length"
              [nzPageSize]="pageSize"
              (nzPageIndexChange)="onPromptPageChange($event)"
            ></nz-pagination>
          </div>
        </nz-sider>
      </div>

      <div class="col-span-4">
        <nz-card>
          @if (!selectedPromptPath) {
            <div nz-typography>Select a prompt to view its content.</div>
          } @else {
            <nz-spin [nzSpinning]="isPromptLoading" nzTip="Loading prompt...">
              @if (promptErrorMessage) {
                <div nz-typography nzType="danger">{{ promptErrorMessage }}</div>
              } @else {
                <div class="mb-3 flex items-center justify-between">
                  <div nz-typography nzType="secondary">Prompt content</div>

                  <button nz-button nzType="default" (click)="togglePromptView()">
                    {{ isMarkdownView ? 'View raw' : 'View markdown' }}
                  </button>
                </div>

                @if (isMarkdownView) {
                  <nz-spin [nzSpinning]="isMarkdownRendering" nzTip="Rendering markdown...">
                    <div class="markdown-content rounded-md border border-slate-200 bg-slate-50 p-4 text-sm"
                         [innerHTML]="renderedContent"
                    ></div>
                  </nz-spin>
                } @else {
                  <pre
                    class="whitespace-pre-wrap break-words rounded-md border border-slate-200 bg-slate-50 p-4 text-sm">
                    {{ content }}
                  </pre>
                }
              }
            </nz-spin>
          }
        </nz-card>
      </div>
    </div>
  </nz-spin>
</div>

<app-prompt-review-modal
  [isVisible]="isReviewModalVisible"
  (isVisibleChange)="isReviewModalVisible = $event"
  [selectedPromptPath]="selectedPromptPath"
  (reviewsQueued)="handleReviewsQueued($event)"
/>

<app-job-created-modal
  [isVisible]="isJobModalVisible"
  (isVisibleChange)="isJobModalVisible = $event"
  [jobIds]="jobModalIds"
/>
