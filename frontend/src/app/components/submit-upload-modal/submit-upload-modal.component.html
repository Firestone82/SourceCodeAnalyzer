<nz-modal
  (nzOnCancel)="closeModal()"
  [nzFooter]="footerTemplate"
  [nzVisible]="isVisible"
  nzTitle="Upload submit"
  nzWidth="700px"
>
  <ng-container *nzModalContent>
    <div class="flex flex-col gap-4">
      <div>
        <label class="mb-1 block text-sm font-medium">Model</label>
        <input
          (ngModelChange)="handleModelChange($event)"
          [ngModel]="uploadModel"
          [nzAutocomplete]="modelAuto"
          nz-input
          placeholder="Model name"
        />
        <nz-autocomplete #modelAuto>
          @for (model of filteredModelOptions; track model) {
            <nz-auto-option [nzValue]="model">{{ model }}</nz-auto-option>
          }
        </nz-autocomplete>
      </div>

      <div>
        <label class="mb-1 block text-sm font-medium">Source bundle (.zip)</label>
        <input (change)="handleSourceFileInput($event)" accept=".zip" type="file"/>
        @if (sourceFileName) {
          <div class="mt-1 text-xs text-slate-500">{{ sourceFileName }}</div>
        }
      </div>

      <div>
        <label class="mb-1 block text-sm font-medium">Source name (optional)</label>
        <input
          (ngModelChange)="handleSourceNameChange($event)"
          [ngModel]="sourceName"
          nz-input
          placeholder="Friendly source name"
        />
      </div>

      <div>
        <label class="mb-1 block text-sm font-medium">Prompt template</label>
        <nz-select
          (ngModelChange)="handlePromptSelection($event)"
          [ngModel]="selectedPromptPath"
          [nzLoading]="isPromptOptionsLoading"
          class="w-full"
          nzAllowClear
          nzPlaceHolder="Select an existing prompt"
        >
          @for (promptPath of promptPaths; track promptPath) {
            <nz-option [nzLabel]="promptPath" [nzValue]="promptPath"></nz-option>
          }
        </nz-select>
      </div>

      <div>
        <label class="mb-1 block text-sm font-medium">Prompt content</label>
        <textarea
          (ngModelChange)="handlePromptDraftChange($event)"
          [ngModel]="promptDraft"
          nz-input
          placeholder="Prompt content"
          rows="12"
        ></textarea>
      </div>

      <div>
        <label class="mb-1 block text-sm font-medium">Prompt name (optional)</label>
        <input
          (ngModelChange)="handlePromptNameChange($event)"
          [ngModel]="promptName"
          nz-input
          placeholder="Prompt name for upload"
        />
      </div>

      @if (promptErrorMessage) {
        <div nz-typography nzType="danger">{{ promptErrorMessage }}</div>
      }

      @if (uploadErrorMessage) {
        <div nz-typography nzType="danger">{{ uploadErrorMessage }}</div>
      }
    </div>
  </ng-container>
</nz-modal>

<ng-template #footerTemplate>
  <app-submit-footer
    (cancel)="closeModal()"
    (submit)="handleSubmit()"
    [isDisabled]="!canSubmit"
    [isSubmitting]="isSubmitting"
    submitLabel="Upload"
  ></app-submit-footer>
</ng-template>
