<nz-modal
  (nzOnCancel)="closeModal()"
  [nzFooter]="footerTemplate"
  [nzVisible]="isVisible"
  nzTitle="Process review"
  nzWidth="800px"
>
  <ng-container *nzModalContent>
    <div class="flex flex-col gap-4">
      <div class="rounded border border-slate-200 bg-slate-50 p-3 text-sm">
        <div class="font-semibold">Prompt</div>
        <div>{{ selectedPromptPath }}</div>
      </div>

      <div>
        <label class="mb-1 block text-sm font-medium">Model</label>
        <input
          (ngModelChange)="handleModelChange($event)"
          [ngModel]="reviewModel"
          [nzAutocomplete]="modelAuto"
          nz-input
          placeholder="Model name"
        />
        <nz-autocomplete #modelAuto>
          @for (model of filteredModelOptions; track model) {
            <nz-auto-option [nzValue]="model">{{ model }}</nz-auto-option>
          }
        </nz-autocomplete>
      </div>

      <div>
        <label class="mb-1 block text-sm font-medium">Sources</label>
        <nz-spin [nzSpinning]="isSourceOptionsLoading" nzTip="Loading sources...">
          <div class="max-h-[40vh] overflow-auto rounded border border-slate-200 p-2"
               (scroll)="handleSourceScroll($event)">
            <nz-tree
              (nzCheckedKeysChange)="handleSourceKeysChange($event)"
              [nzCheckedKeys]="selectedSourceKeys"
              [nzData]="sourceTreeNodes"
              nzCheckable
            ></nz-tree>
            @if (isLoadingMoreSources) {
              <div class="mt-2 text-center text-xs text-slate-500">Loading more sourcesâ€¦</div>
            }
          </div>
        </nz-spin>
      </div>

      @if (reviewSubmitError) {
        <div nz-typography nzType="danger">{{ reviewSubmitError }}</div>
      }
    </div>
  </ng-container>
</nz-modal>

<ng-template #footerTemplate>
  <app-submit-footer
    (cancel)="closeModal()"
    (submit)="handleSubmit()"
    [isDisabled]="!canSubmitBulkReview"
    [isSubmitting]="isSubmittingReview"
  ></app-submit-footer>
</ng-template>
