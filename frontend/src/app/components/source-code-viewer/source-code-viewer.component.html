<div class="flex flex-col">
  @for (line of lines; track line.lineNumber) {
    <div class="flex items-stretch leading-[18px]">
      <!-- line number -->
      <div class="flex items-end min-w-[40px] self-stretch select-none border-r border-black/30 px-[5px] justify-end text-sm">
        <span>{{ line.lineNumber }}</span>
      </div>

      <div class="flex flex-1 flex-col">
        <!-- issues -->
        @if (line.issues.length > 0) {
          <div class="grid gap-2 p-[5px]">
            @for (issue of line.issues; track issue.id) {
              <nz-card
                nzSize="small"
                class="ml-[5px] w-fit max-w-[90%] rounded-[10px]"
              >
                <div class="mb-2 flex items-center justify-between gap-2.5">
                  <div class="flex items-center gap-2">
                    <nz-tag [nzColor]="severityColor(issue.severity)">
                      {{ issue.severity }}
                    </nz-tag>
                    <span nz-typography nzType="secondary">
                      Line {{ issue.line }} Â· Issue #{{ issue.id }}
                    </span>
                  </div>

                  <div class="flex items-center leading-[5px]">
                    @if (issue.rated_at) {
                      <span class="mr-2 text-xs text-gray-500">
                        {{ issue.rated_at | date:'yyyy-MM-dd' }}
                      </span>
                    }
                    <nz-rate
                      [nzCount]="5"
                      [nzAllowHalf]="true"
                      [nzAllowClear]="false"
                      [ngModel]="(issue.rating ?? 0) / 2"
                      (ngModelChange)="onRatingChange(issue, $event)"
                    />
                  </div>
                </div>

                <div class="text-sm">
                  @if (issue.highlightedExplanation) {
                    <span class="issue-text" [innerHTML]="issue.highlightedExplanation"></span>
                  } @else {
                    <span>{{ issue.explanation }}</span>
                  }
                </div>
              </nz-card>
            }
          </div>
        }

        <!-- code line -->
        <div class="px-[5px] font-mono whitespace-pre-wrap break-words [overflow-wrap:anywhere]">
          @if (line.highlightedHtml) {
            <span class="code-text" [innerHTML]="line.highlightedHtml"></span>
          } @else {
            <span>{{ line.text }}</span>
          }
        </div>
      </div>
    </div>
  }
</div>
